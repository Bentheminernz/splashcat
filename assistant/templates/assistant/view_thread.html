{% extends "base.html" %}

{% block content %}
    <h1 class="text-2xl font-splatoon1">
        {% block title %}Viewing Thread from {{ thread.created_date }}{% endblock %}
    </h1>

    <div class="flex flex-col gap-2" id="entire-thread-container" hx-ext="morph">
        {% include 'assistant/htmx/thread_container.html' %}
    </div>

    <div class="text-sm text-gray-200">
        <p>Thread ID: {{ thread.openai_thread_id }}</p>
        <p>File ID:
            {% if thread.status == thread.Status.PENDING %}
                Waiting for thread data... (Runner ID: {{ thread.runner_machine_id }})
            {% else %}
                {{ thread.openai_file_id }}
            {% endif %}</p>
    </div>

    <script>
        const element = document.getElementById("send-message-form");

        element.scrollIntoView({behavior: "smooth", block: "end", inline: "nearest"});

        window.keyUp = function (event) {
            if (event.keyCode === 13 && event.shiftKey) {
                event.preventDefault()
                htmx.trigger("#send-message-form", "submit", {})
            }
        }

        document.body.addEventListener("htmx:sendError", function (event) {
            // Process the error

            if (event.detail.requestConfig.verb !== "GET") return;

            // Retrieve which event fired the request, trigger it again
            const eventType = event.detail.requestConfig.triggeringEvent.type
            setTimeout(function () {
                htmx.trigger(event.detail.elt, eventType, {})
            }, 500) // Adjust the delay as you like
        })
    </script>
{% endblock %}